# gems

Лабораторная по С++. Игра "Gems 3 в ряд".

## Сборка

```
git clone https://github.com/krasnikovra/gems
```

В качестве графического API использована библиотека SFML 2.5.1 32-bit (x86). Линковка SFML - динамическая. В корне есть скрипты копирующие все dll в нужную директорию после сборки, но VS генерирует их Read-Only. Поэтому при первой сборке может выдастся ошибка наподобие

```
1>C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Microsoft\VC\v170\Microsoft.CppCommon.targets(156,5): error MSB3073: выход из команды ".\dllscpy-d.bat
1>C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Microsoft\VC\v170\Microsoft.CppCommon.targets(156,5): error MSB3073: :VCEnd" с кодом 1.
```

Зайдите в свойства директории `Debug` (`Release`) и уберите флажок "Только для чтения". Тогда все dll будут автоматически копироваться скриптом.

## Задание

Игровое поле разбито на квадраты разных цветов. Можно поменять 2 соседних местами, кликнув сначала на одном, потом на другом. Если в результате таких манипуляций 3 или более квадрата одного цвета оказались соседними (не обязательно попарно), они уничтожаются, остальные квадраты сдвигаются вниз, производится еще одна проверка на образование последовательности одноцветных и тд. При уничтожении квадрата может выпасть рандомный бонус в окрестности радиуса 3 квадратов, совершающий следующее:

1. Перекрашивание квадрата, куда попал бонус, и его произвольных 2 НЕсоседей в окрестности в цвет исходного квадрата, откуда выпал бонус
2. «Бомба» - уничтожает 5 произвольных квадратов на поле, включая тот, куда попала

## Механика игры

### Основы

Игровое поле разбито на прямоугольники, но можно подобрать параметры отступов игрового поля от краев окна и так, чтобы оно было разбито именно на квадраты. В квадратах лежат цветные гемы (или бонусы), а не просто квадраты, поскольку нужно каким-то образом визуально отделять бонусы и гемы, поэтому у любого гема или бонуса есть текстура.

Игрок кликает в квадрат на поле (не обязательно на саму текстуру гема), он выделяется (увеличивается в размере). Далее пользователь кликает на еще один квадрат и

1. Если выбранный гем тот же, что и был выбран ранее, то с него снимается выделение.
2. Если выбранные гемы соседние
    1. Если сделанный ход приводит к образованию последовательности гемов, то происходит уничтожение последовательностей гемов, сдвиг оставшихся гемов вниз, проверка и уничтожение новых последовательностей и т.д. пока после сдвига не окажется, что больше последовательностей нет. Затем свободные поля заполняются новыми гемами (все сразу) и игроку может повезти - может появиться комбинация, тогда происходит описанное в прошлом предложении до тех пор, пока заполнение пустых клеток не приведет к образованию новых последовательностей. После того, как все поле заполнено и на нем нет последовательностей, игрок может продолжить игру. Во время уничтожения последовательностей и сдвига игровое поле никак на ввод не реагирует.  
    2. Иначе после непродолжительной задержки гемы возвращаются обратно на свои места.
3. Иначе с выбранного первым гема снимается выделение.

### Бонусы

В игре есть бонусы - это гемы, которые совершают определенные действия при уничтожении.

1. "Бомба" - уничтожает 5 произвольных квадратов на поле, включая тот, куда попала.
2. "Кисть" - перекрашивает квадрат куда попала, а при уничтожении - перекрашивает 2 произвольных не соседних с "кистью" гема.

### Выпадение бонусов

В результате игрового уничтожения гема (обычного, не бонуса) есть шанс выпадения бонуса в радиусе трех квадратов от уничтоженного гема. Если выпал бонус, то

1. Если в квадрате, в который выпал бонус, нет гема, то там появляется бонус цвета гема, уничтожение которого породило бонус.
2. Иначе, стоящий в квадрате, в который выпал бонус, гем, подменяется бонусом (если бомбой - то цвета данного гема, а если кистью - то цвета гема, уничтожение которого породило бонус, поскольку по заданию кисть должна перекрашивать и квадрат куда попала сама).

Уничтожение бонуса не может привести к образованию бонуса.
